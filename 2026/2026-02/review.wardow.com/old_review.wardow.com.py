from agent import *from models.products import *def run(context, session):    session.sessionbreakers = [SessionBreak(max_requests=10000)]    session.queue(Request("https://www.wardow.com/en/"), process_catlist, dict())def process_catlist(data, context, session):    cats = data.xpath('//li[contains(@class, "main-category parent")]')    for cat in cats:        name = cat.xpath('a//text()').string(multiple=True)        url = cat.xpath('.//div[@class="category"]/a/@href').string()        session.queue(Request(url), process_prodlist, dict(cat=name))def process_prodlist(data, context, session):    prods = data.xpath('//li[@data-id]')    for prod in prods:        name = prod.xpath('.//span[@class="product-name"]//text()').string()        ssid = prod.xpath('@data-id').string()        brand = prod.xpath('.//span[@class="product-manufacturer"]//text()').string()        url = prod.xpath('.//div[@class="product-tile__visual"]/a/@href').string()        session.queue(Request(url), process_product, dict(context, name=name, ssid=ssid, brand=brand, url=url))    next_url = data.xpath('//link[@rel="next"]/@href').string()    if next_url:        session.queue(Request(next_url), process_prodlist, dict(context))def process_product(data, context, session):    product = Product()    product.name = context['name']    product.ssid = context['ssid']    product.url = context['url']    product.manufacturer = context['brand']    cats = data.xpath('//li[contains(@class, "category")]/a[@title]')    cat_name = ""    for cat in cats:        cat_name += cat.xpath('text()').string() + "|"    product.category = cat_name.rstrip("|")    if not product.category:        product.category = context['cat']    mpn = data.xpath('//span[@itemprop="sku"]//text()').string()    if mpn:        product.add_property(type='id.manufacturer', value=mpn)    revs_count = data.xpath('//p[@itemprop="ratingCount"]/span//text()').string()    if revs_count and int(revs_count) > 0:        revs = data.xpath('//meta[@itemprop="datePublished"]/parent::head')        for rev in revs:            review = Review()            review.type = 'user'            review.url = product.url            review.title = rev.xpath('following::span[@itemprop="headline"][1]//text()').string()            date = rev.xpath('meta/@content').string()            if date:                review.date = date.split('T')[0]            author = rev.xpath('following::span[@itemprop="author"][1]//text()').string()            if author:                review.authors.append(Person(name=author, ssid=author))            review.add_property(type='is_verified_buyer', value=True)                # all revs from verified buyers            grade_overall = rev.xpath('following::meta[@itemprop="ratingValue"][1]/@content').string()            if grade_overall:                review.grades.append(Grade(type='overall', value=float(grade_overall), best=5.0))            excerpt = rev.xpath('following::p[@itemprop="reviewBody"][1]/span//text()').string(multiple=True)            if excerpt:                review.add_property(type='excerpt', value=excerpt)                review.ssid = review.digest() if author else review.digest(excerpt)                product.reviews.append(review)    if product.reviews:        session.emit(product)      # no next page (not more 10 reviews on site)