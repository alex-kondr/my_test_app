from agent import *from models.products import *import redebug = Truedef process_category(data, context, session):    for view in data.xpath("//div[@id='center']/div[@class='navbar navbar-default pager-navbar justify-content-center justify-content-sm-between'][1]//div[@class='dropdown-menu']//a"):         url = view.xpath("(.)/@href").string()          if url:            session.do(Request(url), process_category1, {})def process_category1(data, context, session):    for view in data.xpath("//div[@class='media-body']"):         url = view.xpath("(.)/h4/a/@href").string()          name = view.xpath("(.)/h4/a//text()[string-length(normalize-space(.))>1]").join(" ")        exc = view.xpath("(.)/p[@class='content-lead']//text()[string-length(normalize-space(.))>1]").join(" ")        if url:            ssid = url           session.do(Request(url), process_product, {'url' : url, 'name' : name, 'ssid' : ssid, 'exc' : exc}) def process_product(data, context, session):       product = Product()      product.name =context['name']     product.url = context['url']     product.ssid = context['ssid']     product.category = 'Computers and accessories'      review = Review()      review.product = product.name       review.url = product.url       review.ssid = context['ssid']     review.type = "pro"     review.date = data.xpath("//li[@class='list-inline-item'][time]/text()[string-length(normalize-space(.))>1]").join("")    avt_n = data.xpath("//li[@class='list-inline-item mr-md-auto']//a//text()[string-length(normalize-space(.))>1]").join(" ")    avt_u = data.xpath("//li[@class='list-inline-item mr-md-auto']//a/@href").join(" ")    if avt_u:       review.authors.append(Person(name = avt_n, profile_url = avt_u, ssid = avt_u))    for ris in data.xpath("//div[@class='content-body']//img"):        src = ris.xpath("(.)/@src").string()        if src:           product.properties.append(ProductProperty(type="image", value = {'src' : src}))      excerpt = context['exc']     if excerpt:         review.properties.append(ReviewProperty(type="excerpt", value = excerpt))     next = data.xpath("//ul[@class='list-inline content-info my-3 justify-content-between justify-content-md-center']//div[@class='dropdown-menu']/a[last()]/@href").string()    if next:       session.do(Request(next), process_con, {'review' : review, 'product' : product})    product.reviews.append(review)       session.emit(product)     def process_con(data, context, session):    product = context['product']    review = context['review']    for ris in data.xpath("//div[@class='content-body']//img"):        src = ris.xpath("(.)/@src").string()        if src:           product.properties.append(ProductProperty(type="image", value = {'src' : src}))     conc = data.xpath("//div[@class='content-body']/p[text()[string-length(normalize-space(.))>10]][last()]//text()[string-length(normalize-space(.))>1]").join("")    if conc:         review.properties.append(ReviewProperty(type="conclusion", value = conc))def run(context, session):        session.queue(Request('http://prohardver.hu/tesztek/index.html'), process_category, {})