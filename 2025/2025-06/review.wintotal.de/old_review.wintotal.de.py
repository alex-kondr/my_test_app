from agent import *from models.products import *debug = Truedef process_frontpage(data, context, session):    cats = data.xpath("//li[contains(.,'Test')]/ul/li//a")    for cat in cats:        name = cat.xpath(".//text()").string()        url = cat.xpath("@href").string()        session.queue(Request(url), process_category, dict(context, cat=name, url=url))def process_category(data, context, session):    prods = data.xpath("//div[@id='main']//h2/a")    for prod in prods:        url = prod.xpath("@href").string()        title = prod.xpath(".//text()").string()        session.queue(Request(url), process_review, dict(context, url=url, title=title))        nexturl = data.xpath("//ul[@class='clearfix']/li[contains(.,'→')]/a/@href").string()    if nexturl:        session.queue(Request(nexturl), process_category, dict(context))def process_review(data, context, session):    product = Product()    product.name = context['title'].split(': ')[0].split(' – ')[0]    product.ssid = context['url'].split('/')[-2].replace('.html', '')    product.category = context['cat']    product.url = context['url']        review = Review()    review.title = context['title']    review.ssid = product.ssid    review.type = 'pro'    review.url = context['url']    review.date = data.xpath("//p[@class='meta']/time/@datetime").string().split('T')[0]        authors = data.xpath("//p[@class='meta']/a[2]")    for author in authors:        author_name = author.xpath(".//text()").string()        author_url = author.xpath("@href").string()        review.authors.append(Person(name=author_name, profile_url=author_url, ssid=author_name))        excerpt = data.xpath("//div[@id='main']//p//text()").string(multiple=True)    if excerpt:        if 'WT-News' in excerpt:            excerpt = excerpt.split('WT-News')[1]        if '|' in excerpt:            excerpt = excerpt.split('|')[1]        excerpt = excerpt.split('Abbrechen')[0]        review.properties.append(ReviewProperty(type='excerpt', value=excerpt.strip()))        pros = data.xpath("//ul[@class='pro']/li//text()")    for pro in pros:        pro = pro.string().replace('+', '').strip()        review.add_property(type='pros', value=pro)        cons = data.xpath("//ul[@class='contra']/li//text()")    for con in cons:        con = con.string().replace('- ', '').strip()        review.add_property(type='cons', value=con)        product.reviews.append(review)    session.emit(product)def run(context, session):    session.queue(Request('https://www.wintotal.de/'), process_frontpage, {})