from agent import *from models.products import *def run(context, session):    session.queue(Request('https://top-mob.com/?s=%D0%9E%D0%91%D0%97%D0%9E%D0%A0'), process_revlist, {})def process_revlist(data, context, session):    revs = data.xpath("//h2[@class='entry-title']/a")    for rev in revs:        name = rev.xpath(".//text()").string()        url = rev.xpath("@href").string()        if name and url:            session.queue(Request(url), process_review, dict(context, name=name, url=url))    next_url = data.xpath("//a[@class='next page-numbers']/@href").string()    if next_url:        session.queue(Request(next_url), process_revlist, dict(context))def process_review(data, context, session):    product = Product()    product.name = context['name']    product.ssid = context['url'].split('/')[-2]    product.category = data.xpath("//span[@class='cat-links']/a//text()").string()    product.url = context['url']    review = Review()    review.title = context['name']    review.ssid = product.ssid    review.type = 'pro'    review.url = context['url']    review.date = data.xpath("//time[@class='entry-date published']/@datetime").string().split('T')[0]    author = data.xpath("//span[@class='author vcard']/a").first()    if author:        author_name = author.xpath(".//text()").string()        author_url = author.xpath("@href").string()        author_ssid = author_url.split("/")[-2]        review.authors.append(Person(name=author_name, profile_url=author_url, ssid=author_ssid))    conclusion = data.xpath("//*[contains(translate(., 'И','и'),'итог')]/following-sibling::p//text()").string(multiple=True)    if not conclusion:        conclusion = data.xpath("//*[contains(translate(., 'В','в'),'вывод')]/following-sibling::p//text()").string(multiple=True)    if not conclusion:        conclusion = data.xpath("//*[contains(translate(., 'Р','р'),'рекомендац')]/following-sibling::p//text()").string(multiple=True)    if conclusion:        review.properties.append(ReviewProperty(type='conclusion', value=conclusion))    excerpt = data.xpath("//div[@class='entry-content']//p//text()").string(multiple=True)    if excerpt:        if conclusion:            excerpt = excerpt.replace(conclusion, '')        review.properties.append(ReviewProperty(type='excerpt', value=excerpt))        product.reviews.append(review)        session.emit(product)