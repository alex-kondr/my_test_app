from agent import *from models.products import *def run(context, session):    session.queue(Request("http://rezensionen-fuer-millionen.blogspot.com/2008/04/register.html"), process_revlist, {})def process_revlist(data, context, session):    for rev in data.xpath("//div[@class='post-body entry-content']/p//a"):        name = rev.xpath("text()").string(multiple=True)        url = rev.xpath("@href").string(multiple=True)        if url and name:            session.queue(Request(url), process_review, dict(name=name, url=url))def process_review(data, context, session):    content = data.xpath("//div[@class='post-body entry-content']").first()    if content:        product = Product()        product.name = context['name']        product.category = 'Games'        product.url = context['url']        product.ssid = product.url.split('/')[-1].replace('.html', '')        review = Review()        review.type = 'pro'        review.title = data.xpath("//h3[@class='post-title entry-title']/a/text()").string()        review.url = product.url        review.ssid = product.ssid        date = data.xpath("//h2[@class='date-header']/text()").string()        review.date = date.split(',')[-1].strip()        author = data.xpath("//span[@class='post-author vcard']/span/text()").string()        if author:            review.authors.append(Person(name=author, ssid=author))        score = data.xpath("//span[@class='post-labels']/a/text()").string()        if score:            score = len(score.strip().split()[0])            review.grades.append(Grade(type='overall', value=score, best=7, worst=1))        excerpt = data.xpath("//div[@class='post-body entry-content']//text()").string(multiple=True)        if excerpt:            review.properties.append(ReviewProperty(type='excerpt', value=excerpt))            product.reviews.append(review)            session.emit(product)