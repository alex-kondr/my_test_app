from agent import *from models.products import *def process_prodlist(data, context, session):    prods = data.xpath("//h2[@class='entry-title']/a")    for prod in prods:        name = prod.xpath("text()").string()        url = prod.xpath("@href").string()        session.queue(Request(url, use='curl'), process_product, dict(context, name=name, url=url))    nexturl = data.xpath("//div[@class='nav-previous']//a/@href").string()    if nexturl:        session.queue(Request(nexturl, use='curl'), process_prodlist, dict(context))def process_product(data, context, session):    product = Product()    product.name = context['name'].split("Review")[0]    product.ssid = context['url'].split('/')[-2]    product.url = context['url']    product.category = data.xpath("//a[@rel='category tag']//text()").string()    review = Review()    review.title = context['name']    review.date = data.xpath("//time[@class='entry-date published']/@datetime").string().split("T")[0]    review.ssid = product.ssid    review.type = 'pro'    review.url = context['url']        author_name = data.xpath("//span[@class='author vcard']//text()").string(multiple=True)    if author_name:        review.authors.append(Person(name=author_name, ssid=author_name))        conclusion = data.xpath("//div[@class='entry-content']//h3[contains(., 'Summary')]/following-sibling::p[1]//text()").string(multiple=True)    if conclusion:        review.properties.append(ReviewProperty(type='conclusion', value=conclusion))        excerpt = data.xpath("//div[@class='entry-content']//p//text()").string(multiple=True)    if excerpt:        if conclusion:            excerpt = excerpt.replace(conclusion,'')        excerpt = excerpt.strip().strip("Contents")        review.properties.append(ReviewProperty(type='excerpt', value=excerpt))        product.reviews.append(review)        session.emit(product)def run(context, session):    session.queue(Request("https://thelitereview.com/reviews", use='curl'), process_prodlist, dict())