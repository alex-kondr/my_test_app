import stringfrom agent import *from models.products import *import redef process_view_category(data, context, session):    for view_categoryline in data.xpath("//p[@align='center']/b//a"):        context['product_url'] = view_categoryline.xpath("@href").string()        context['product_name'] = view_categoryline.xpath(".//text()[string-length(normalize-space(.))>1]").join(" ")        if context['product_url'] and context['product_name']:            session.queue(Request(context['product_url']), process_product, context)            #session.emit(Product(name = context['product_name'], url = context['product_url'], category = context['category_name']))def process_product(data, context, session):     product = Product()    product.url = context['product_url']     product.ssid = context['product_url']    product.name = context['product_name']    product.category = 'Movie'    for imageline in data.xpath("//img[contains(@src,'/img/')]"):        url_image = imageline.xpath("@src").string()        if url_image:            product.properties.append(ProductProperty(type='image' , value = {'src': url_image, 'type': 'product'}))    review = Review()    review.url = context['product_url']     review.ssid = context['product_url']     review.title = context['product_name']    review.type = 'pro'    excerpt = data.xpath("//p[.//text()[string-length(normalize-space(.))>100]][1]//text()").join(" ")    if excerpt:        review.properties.append(ReviewProperty(type='excerpt', value = excerpt))    product.reviews.append(review)    if excerpt:      session.emit(product)def run(context, session):    session.queue(Request('http://www.filmrecensiepagina.nl/films-filmoverzicht.htm'), process_view_category, {}) 